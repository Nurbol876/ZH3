<!doctype html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>ZH3 ai</title>
    <link rel="icon" href="../src/assets/ethereum.svg">
    <!-- Chart.js from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Bitcount+Grid+Single:wght@100..900&display=swap');
        :root{
            --bg:#0f1720;
            --card:#0b1220;
            --muted:#9aa4b2;
            --accent:#5b7cff;
            --danger:#ff6b6b;
            --glass: rgba(255,255,255,0.03);
            --radius:14px;
            font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
        }
        *{box-sizing:border-box}
        body{
            margin:0;
            background:linear-gradient(180deg,var(--bg),#071019 120%);
            color:#e6eef8;
            -webkit-font-smoothing:antialiased;
            -moz-osx-font-smoothing:grayscale;
            min-height:100vh;
            padding:28px;
        }

        .wrap{
            max-width:1100px;
            margin:0 auto;
            background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
            border-radius:var(--radius);
            padding:22px;
            box-shadow: 0 10px 30px rgba(2,6,23,0.7);
            border:1px solid rgba(255,255,255,0.03);
        }

        header{
            display:flex;
            gap:16px;
            align-items:center;
            margin-bottom:12px;
        }
        .logo{
            width:52px;height:52px;border-radius:12px;
            background:linear-gradient(135deg,var(--accent),#2dd4bf);
            display:flex;align-items:center;justify-content:center;
            font-weight:700;color:#071019;font-size:18px;
            box-shadow:0 6px 18px rgba(91,124,255,0.12), inset 0 -6px 18px rgba(255,255,255,0.03);
        }
        h1{font-size:18px;margin:0}
        p.lead{color:var(--muted);margin:2px 0 0;font-size:13px}

        .controls{
            display:flex;
            gap:12px;
            margin:18px 0;
            flex-wrap:wrap;
        }

        .card{
            background:var(--card);
            padding:12px;
            border-radius:12px;
            border:1px solid rgba(255,255,255,0.02);
            box-shadow: 0 4px 14px rgba(2,6,23,0.4);
        }

        label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
        input[type="text"], select{
            background:var(--glass);
            border:1px solid rgba(255,255,255,0.03);
            color:inherit;padding:8px 10px;border-radius:8px;width:220px;
        }
        button{
            background:var(--accent);
            color:#071019;border:none;padding:10px 14px;border-radius:10px;font-weight:600;cursor:pointer;
        }
        button.ghost{background:transparent;color:var(--muted);border:1px solid rgba(255,255,255,0.04)}
        .small{font-size:13px;padding:8px 10px}

        .stats{
            display:grid;
            grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
            gap:12px;margin-top:12px;
        }
        .stat{
            padding:12px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
            border:1px solid rgba(255,255,255,0.02);
        }
        .stat .value{font-size:16px;font-weight:700}
        .muted{color:var(--muted);font-size:13px}

        .chart-wrap{margin-top:16px;padding:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));border-radius:12px}
        canvas{width:100% !important;height:420px !important}

        .note{margin-top:12px;color:var(--muted);font-size:13px}
        footer{margin-top:16px;color:var(--muted);font-size:13px;display:flex;justify-content:space-between;gap:12px;align-items:center}
        @media (max-width:720px){
            input[type="text"], select{width:100%}
            header{flex-direction:column;align-items:flex-start;gap:6px}
        }
    </style>
</head>
<body>

<div class="wrap">
    <header>
        <div class="logo">CP</div>
        <div>
            <h1>AI Crypto Predictor — Next 5 Hours</h1>
            <a href="../index.html" class="lead">Go home</a>
        </div>
    </header>

    <div class="controls">
        <div class="card">
            <label for="coin">Coin ID (CoinGecko)</label>
            <input id="coin" type="text" value="bitcoin" placeholder="e.g. bitcoin, ethereum, solana" />
        </div>

        <div class="card">
            <label for="currency">Currency</label>
            <input id="currency" type="text" value="usd" placeholder="usd" />
        </div>

        <div class="card" style="display:flex;flex-direction:column;justify-content:space-between;">
            <div style="display:flex;gap:8px;">
                <button id="update">Update</button>
                <button id="toggle" class="ghost small">Auto: on</button>
            </div>
            <div style="margin-top:8px;">
                <label class="muted">Update every 60 seconds</label>
            </div>
        </div>

        <div class="card">
            <label>Using model</label>
            <div class="muted">Simple linear regression based on the last points (demo).</div>
        </div>
    </div>

    <div class="stats">
        <div class="stat">
            <div class="muted">Latest price</div>
            <div id="lastPrice" class="value">—</div>
        </div>
        <div class="stat">
            <div class="muted">Prediction after 1 hour</div>
            <div id="pred1" class="value">—</div>
        </div>
        <div class="stat">
            <div class="muted">Prediction for next 5 hour</div>
            <div id="pred5" class="value">—</div>
        </div>
        <div class="stat">
            <div class="muted">Status</div>
            <div id="status" class="value muted">Ready</div>
        </div>
    </div>

    <div class="chart-wrap card">
        <canvas id="chart"></canvas>
        <div id="error" class="muted" style="margin-top:8px"></div>
    </div>




</div>

<script>


    const coinInput = document.getElementById('coin');
    const currencyInput = document.getElementById('currency');
    const updateBtn = document.getElementById('update');
    const toggleBtn = document.getElementById('toggle');
    const lastPriceEl = document.getElementById('lastPrice');
    const pred1El = document.getElementById('pred1');
    const pred5El = document.getElementById('pred5');
    const statusEl = document.getElementById('status');
    const errorEl = document.getElementById('error');

    let autoRefresh = true;
    let autoTimer = null;
    let chart = null;

    function initChart(){
        const ctx = document.getElementById('chart').getContext('2d');
        chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [], // time labels
                datasets: [
                    { label: 'Actual', data: [], borderWidth: 2, tension: 0.2, pointRadius: 0, borderColor: undefined /* default */ },
                    { label: 'Predicted', data: [], borderWidth: 2, tension: 0.2, borderDash: [6,4], pointRadius: 3, borderColor: undefined }
                ]
            },
            options: {
                animation: false,
                plugins: {
                    legend: { labels: { color: '#cfe6ff' } },
                    tooltip: { mode: 'index', intersect: false, callbacks: { label: (ctx) => typeof ctx.raw === 'number' ? ctx.raw.toFixed(6) : ctx.raw } }
                },
                scales: {
                    x: { ticks: { color: '#9aa4b2' } },
                    y: { ticks: { color: '#9aa4b2' } }
                }
            }
        });
    }

    // Fetch prices from CoinGecko: market_chart?vs_currency=...&days=1
    async function fetchCoinPrices(coin='bitcoin', vs='usd'){
        const endpoint = `https://api.coingecko.com/api/v3/coins/${encodeURIComponent(coin)}/market_chart?vs_currency=${encodeURIComponent(vs)}&days=1`;
        const res = await fetch(endpoint);
        if (!res.ok) throw new Error(`CoinGecko returned ${res.status}`);
        const json = await res.json();
        if (!Array.isArray(json.prices)) throw new Error('No price data');
        const mapped = json.prices.map(p => ({time: p[0], price: p[1]}));
        return mapped.slice(-480);
    }

    function linearRegression(points){
        if (!points || points.length < 2) return { slope: 0, intercept: points?.[0]?.price ?? 0, t0: points?.[0]?.time ?? Date.now() };
        const t0 = points[0].time;
        let n=0, sumX=0, sumY=0, sumXX=0, sumXY=0;
        for (const p of points){
            const x = (p.time - t0)/1000;
            const y = p.price;
            n++; sumX += x; sumY += y; sumXX += x*x; sumXY += x*y;
        }
        const denom = n*sumXX - sumX*sumX;
        const slope = denom === 0 ? 0 : (n*sumXY - sumX*sumY)/denom;
        const intercept = (sumY - slope*sumX)/n;
        return { slope, intercept, t0 };
    }

    // Produce hourly predictions for next `hours`
    function producePredictions(points, hours=5){
        if (!points || points.length===0) return [];
        const { slope, intercept, t0 } = linearRegression(points);
        const lastTime = points[points.length-1].time;
        const oneHourMs = 60*60*1000;
        const preds = [];
        for (let i=1;i<=hours;i++){
            const t = lastTime + i*oneHourMs;
            const x = (t - t0)/1000;
            const price = slope*x + intercept;
            preds.push({ time: t, price });
        }
        return preds;
    }

    function buildChartData(actual, preds){
        const labels = actual.map(a => new Date(a.time).toLocaleTimeString());
        const actualData = actual.map(a => a.price);
        for (const p of preds){
            labels.push(new Date(p.time).toLocaleTimeString());
        }
        const predictedData = Array(actual.length).fill(null).concat(preds.map(p=>p.price));
        const fullActualData = actualData.concat(Array(preds.length).fill(null));
        return { labels, actual: fullActualData, predicted: predictedData };
    }

    async function updateAll(){
        const coin = coinInput.value.trim() || 'bitcoin';
        const vs = currencyInput.value.trim() || 'usd';
        statusEl.textContent = 'Uploading…';
        errorEl.textContent = '';
        try{
            const pts = await fetchCoinPrices(coin, vs);
            if (pts.length === 0) throw new Error('No data from CoinGecko');
            // choose recent subset for regression to react to current trend
            const recentCount = Math.min(120, pts.length);
            const recent = pts.slice(-recentCount);
            const preds = producePredictions(recent, 5);

            // Update small stats
            const last = pts[pts.length-1].price;
            lastPriceEl.textContent = `${last.toFixed(6)} ${vs.toUpperCase()}`;
            pred1El.textContent = preds[0] ? `${preds[0].price.toFixed(6)} ${vs.toUpperCase()}` : '—';
            pred5El.textContent = preds[4] ? `${preds[4].price.toFixed(6)} ${vs.toUpperCase()}` : '—';

            // Update chart
            const { labels, actual, predicted } = buildChartData(pts, preds);
            chart.data.labels = labels;
            chart.data.datasets[0].data = actual;
            chart.data.datasets[1].data = predicted;
            chart.update();

            statusEl.textContent = `Updated: ${new Date().toLocaleTimeString()}`;
        }catch(err){
            console.error(err);
            errorEl.textContent = `Error: ${err.message || err}`;
            statusEl.textContent = 'Error';
        }
    }

    // UI wiring
    updateBtn.addEventListener('click', () => updateAll());
    toggleBtn.addEventListener('click', () => {
        autoRefresh = !autoRefresh;
        toggleBtn.textContent = autoRefresh ? 'Auto: on' : 'Auto: off';
        toggleBtn.classList.toggle('ghost', !autoRefresh);
        if (autoRefresh){
            startAuto();
        } else {
            stopAuto();
        }
    });

    function startAuto(){
        stopAuto();
        autoTimer = setInterval(() => updateAll(), 60*1000);
    }
    function stopAuto(){
        if (autoTimer) { clearInterval(autoTimer); autoTimer = null; }
    }

    initChart();
    updateAll();
    startAuto();

</script>
</body>
</html>